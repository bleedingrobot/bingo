<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Epic Bingo Multiplayer</title>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #222;
      margin: 0;
    }
    .container { max-width: 1100px; margin: 0 auto; padding: 24px; }
    .header { text-align: center; color: white; margin-bottom: 32px; }
    .game-board, .leaderboard { background: white; border-radius: 16px; box-shadow: 0 6px 28px rgba(0,0,0,0.15); margin-bottom: 32px; }
    .game-board { padding: 24px; }
    .checklist-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 14px; }
    .checklist-item { background: #f8f9fa; border-radius: 8px; padding: 10px 14px; display: flex; align-items: center; border: 2px solid transparent; }
    .checklist-item.completed { background: #4285F4; color: white; border-color: #1A73E8; }
    .checklist-item input { margin-right: 12px; }
    .leaderboard { padding: 24px; }
    .leaderboard h2 { margin-top: 0; color: #4285F4; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px 8px; border-bottom: 1px solid #eee; text-align: left; }
    th { background: #4285F4; color: white; }
    tr.highlight { background: #e0f7fa; }
    .btn { background: #4285F4; color: white; border: none; border-radius: 6px; padding: 10px 18px; font-size: 1rem; cursor: pointer; margin: 5px; }
    .btn:disabled { background: #aaa; }
    #menu { display: flex; flex-direction: column; gap: 16px; align-items: center; }
    @media (max-width: 600px) {
      .checklist-grid { grid-template-columns: 1fr; }
      .container { padding: 6px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üéÆ Epic Bingo Multiplayer</h1>
      <p>Compete in real time ‚Äî see everyone's progress as you play!</p>
    </div>
    <div id="menu">
      <input type="text" id="playerNameInput" placeholder="Enter your name" maxlength="20" />
      <select id="difficultyInput">
        <option value="easy">Easy (3x3)</option>
        <option value="normal" selected>Normal (4x5)</option>
        <option value="hard">Hard (5x6)</option>
        <option value="epic">Epic (6x6)</option>
      </select>
      <button class="btn" id="startBtn">Start Game</button>
    </div>

    <div id="gameBoard" class="game-board" style="display:none;">
      <h2 id="gameTitle"></h2>
      <div>
        <span><b>Score:</b> <span id="currentScore">0</span> / <span id="totalItems">0</span></span>
        <span style="margin-left: 18px;"><b>Complete:</b> <span id="completionPercent">0%</span></span>
        <button class="btn" id="backToMenuBtn" style="float:right;">Back to Menu</button>
      </div>
      <hr>
      <div id="checklistContainer" class="checklist-grid"></div>
    </div>

    <div id="leaderboard" class="leaderboard" style="display:none;">
      <h2>üèÜ Live Leaderboard</h2>
      <table>
        <thead>
          <tr>
            <th>Player</th>
            <th>Score</th>
            <th>Difficulty</th>
            <th>Progress</th>
          </tr>
        </thead>
        <tbody id="leaderboardBody">
          <!-- Populated by JS -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Firebase config: YOURS, ready to use! -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDeQPS8fkc6uH9shQye35At98Fa5V62Z7A",
      authDomain: "bingo-e3517.firebaseapp.com",
      databaseURL: "https://bingo-e3517-default-rtdb.firebaseio.com",
      projectId: "bingo-e3517",
      storageBucket: "bingo-e3517.appspot.com",
      messagingSenderId: "338765367468",
      appId: "1:338765367468:web:9d539fe8e1b5351c123709",
      measurementId: "G-VFXRMS6LN7"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>

  <script>
    // --- Checklist items (shortened for demo; add more as needed) ---
    const checklistItems = [
      "Try a new restaurant", "Read a book you've been meaning to read", "Call an old friend", "Take a nature walk", "Learn something new online",
      "Organize your workspace", "Cook a meal from scratch", "Write in a journal", "Do a random act of kindness", "Watch a documentary",
      "Start a new hobby", "Exercise for 30 minutes", "Clean out your email inbox", "Plan your next vacation", "Take photos of something beautiful",
      "Listen to a new music genre", "Meditate for 10 minutes", "Write a thank you note", "Try a new recipe", "Go stargazing",
      "Visit a museum or gallery", "Learn 5 words in a new language", "Volunteer for a cause you care about", "Create something with your hands", "Have a picnic",
      "Watch the sunrise or sunset", "Call your family", "Donate items you don't need", "Try a new form of exercise", "Plant something", "Write down 3 things you're grateful for",
      "Explore a new neighborhood", "Have a device-free hour", "Make a playlist for a friend", "Try meditation or deep breathing", "Organize your photos", "Learn a magic trick"
      // ... (add more for larger boards)
    ];

    const difficultySettings = {
      easy: { rows: 3, cols: 3, total: 9 },
      normal: { rows: 4, cols: 5, total: 20 },
      hard: { rows: 5, cols: 6, total: 30 },
      epic: { rows: 6, cols: 6, total: 36 }
    };

    let playerName = "";
    let playerId = "";
    let currentGame = null;
    let currentDifficulty = "normal";
    let checklist = [];
    let completed = [];

    // Elements
    const menu = document.getElementById('menu');
    const gameBoard = document.getElementById('gameBoard');
    const leaderboard = document.getElementById('leaderboard');
    const playerNameInput = document.getElementById('playerNameInput');
    const difficultyInput = document.getElementById('difficultyInput');
    const startBtn = document.getElementById('startBtn');
    const backToMenuBtn = document.getElementById('backToMenuBtn');

    // Firebase paths
    const LEADERBOARD_PATH = "bingo-multiplayer/players";

    function shuffleArray(array) {
      const arr = [...array];
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function updateLeaderboardUI(players) {
      const tbody = document.getElementById('leaderboardBody');
      tbody.innerHTML = "";
      const sorted = Object.values(players || {}).sort((a, b) => {
        const aPercent = (a.completedCount || 0) / (a.totalItems || 1);
        const bPercent = (b.completedCount || 0) / (b.totalItems || 1);
        if (aPercent !== bPercent) return bPercent - aPercent;
        return (b.completedCount || 0) - (a.completedCount || 0);
      });
      sorted.forEach(p => {
        const tr = document.createElement('tr');
        if (p.id === playerId) tr.className = "highlight";
        tr.innerHTML = `<td>${p.name}</td>
          <td>${p.completedCount || 0}/${p.totalItems}</td>
          <td>${p.difficulty}</td>
          <td>${Math.round((p.completedCount || 0) / (p.totalItems || 1) * 100)}%</td>`;
        tbody.appendChild(tr);
      });
      leaderboard.style.display = gameBoard.style.display === "block" ? "block" : "none";
    }

    function renderChecklist() {
      const container = document.getElementById('checklistContainer');
      container.innerHTML = "";
      checklist.forEach((item, idx) => {
        const div = document.createElement('div');
        div.className = "checklist-item" + (completed[idx] ? " completed" : "");
        div.innerHTML = `<input type="checkbox" ${completed[idx] ? "checked" : ""} id="item-${idx}">
          <label for="item-${idx}">${idx + 1}. ${item}</label>`;
        div.querySelector('input').addEventListener('change', () => toggleItem(idx));
        container.appendChild(div);
      });
    }

    function toggleItem(idx) {
      completed[idx] = !completed[idx];
      updateProgress();
      saveToFirebase();
      renderChecklist();
    }

    function updateProgress() {
      const completedCount = completed.filter(Boolean).length;
      const total = checklist.length;
      document.getElementById('currentScore').textContent = completedCount;
      document.getElementById('totalItems').textContent = total;
      document.getElementById('completionPercent').textContent = `${Math.round(completedCount / total * 100)}%`;
    }

    function saveToFirebase() {
      // Save player state to Firebase
      db.ref(`${LEADERBOARD_PATH}/${playerId}`).set({
        id: playerId,
        name: playerName,
        difficulty: currentDifficulty,
        completedCount: completed.filter(Boolean).length,
        totalItems: checklist.length,
        timestamp: Date.now()
      });
    }

    startBtn.onclick = function() {
      playerName = playerNameInput.value.trim();
      if (!playerName) { alert("Please enter your name!"); return; }
      currentDifficulty = difficultyInput.value;
      // Player ID is name + a short random string (to allow duplicate names, but unique per tab)
      playerId = playerName.replace(/\W/g,"") + "_" + Math.random().toString(36).substr(2, 4);
      // Build the board
      const { total } = difficultySettings[currentDifficulty];
      checklist = shuffleArray(checklistItems).slice(0, total);
      completed = Array(total).fill(false);

      // UI
      document.getElementById('gameTitle').textContent = `üéÆ ${playerName}'s ${currentDifficulty} Board`;
      menu.style.display = "none";
      gameBoard.style.display = "block";
      leaderboard.style.display = "block";
      renderChecklist();
      updateProgress();
      saveToFirebase();
    };

    backToMenuBtn.onclick = function() {
      menu.style.display = "flex";
      gameBoard.style.display = "none";
      leaderboard.style.display = "none";
      // Optionally remove player from leaderboard on leaving:
      // db.ref(`${LEADERBOARD_PATH}/${playerId}`).remove();
    };

    // Live leaderboard update
    db.ref(LEADERBOARD_PATH).on('value', snapshot => {
      updateLeaderboardUI(snapshot.val());
    });

    // Optional: Remove player from leaderboard when they close the tab
    window.addEventListener('beforeunload', function() {
      if (playerId) db.ref(`${LEADERBOARD_PATH}/${playerId}`).remove();
    });
  </script>
</body>
</html>
