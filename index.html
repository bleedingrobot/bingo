<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Epic Checklist Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-menu {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .menu-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .menu-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .menu-card h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #4285F4;
        }

        .menu-card p {
            color: #666;
            margin-bottom: 20px;
        }

        .btn {
            background: #4285F4;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s ease;
            width: 100%;
        }

        .btn:hover {
            background: #1A73E8;
        }

        .btn-danger {
            background: #FF5722;
        }

        .btn-danger:hover {
            background: #D84315;
        }

        .btn-success {
            background: #4CAF50;
        }

        .btn-success:hover {
            background: #2E7D32;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal h2 {
            margin-bottom: 20px;
            color: #4285F4;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4285F4;
        }

        .game-board {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .game-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .game-header h2 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .game-header p {
            color: #666;
            font-size: 1.1rem;
        }

        .progress-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }

        .progress-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .stat {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4285F4;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }

        .progress-message {
            font-size: 1.2rem;
            font-weight: bold;
            margin-top: 15px;
        }

        .checklist-grid {
            display: grid;
            gap: 15px;
            margin-bottom: 30px;
        }

        .checklist-grid.mobile {
            grid-template-columns: 1fr;
        }

        .checklist-grid.desktop {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }

        .checklist-item {
            display: flex;
            align-items: center;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .checklist-item.completed {
            background: #4285F4;
            color: white;
            border-color: #1A73E8;
        }

        .checklist-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 15px;
            cursor: pointer;
        }

        .checklist-item label {
            flex: 1;
            cursor: pointer;
            font-size: 1rem;
        }

        .leaderboard {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .leaderboard h2 {
            text-align: center;
            margin-bottom: 25px;
            color: #4285F4;
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
        }

        .leaderboard-table th,
        .leaderboard-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .leaderboard-table th {
            background: #4285F4;
            color: white;
            font-weight: bold;
        }

        .leaderboard-table tr:hover {
            background: #f5f5f5;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .main-menu {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
                margin: 20px;
            }
            
            .checklist-grid {
                grid-template-columns: 1fr !important;
            }
            
            .leaderboard-table {
                font-size: 0.9rem;
            }
        }

        .theme-classic { --primary: #4285F4; --secondary: #E8F0FE; --accent: #1A73E8; }
        .theme-fire { --primary: #FF5722; --secondary: #FFF3E0; --accent: #D84315; }
        .theme-nature { --primary: #4CAF50; --secondary: #F1F8E9; --accent: #2E7D32; }
        .theme-royal { --primary: #9C27B0; --secondary: #F3E5F5; --accent: #7B1FA2; }
        .theme-neon { --primary: #E91E63; --secondary: #FCE4EC; --accent: #C2185B; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ Epic Checklist Game</h1>
            <p>Challenge yourself with epic checklists and compete with friends!</p>
        </div>

        <div id="mainMenu" class="main-menu">
            <div class="menu-card" onclick="showCreateGameModal()">
                <h3>üéØ Create New Game</h3>
                <p>Start a fresh challenge with your own custom settings</p>
                <button class="btn btn-success">Create Game</button>
            </div>

            <div class="menu-card" onclick="showJoinGameModal()">
                <h3>üöÄ Join Existing Game</h3>
                <p>Jump into a game that's already been created</p>
                <button class="btn">Join Game</button>
            </div>

            <div class="menu-card" onclick="showLeaderboard()">
                <h3>üèÜ Leaderboard</h3>
                <p>See how you stack up against other players</p>
                <button class="btn">View Scores</button>
            </div>

            <div class="menu-card" onclick="showAdminPanel()">
                <h3>üõ†Ô∏è Admin Panel</h3>
                <p>Manage games and reset data (admin only)</p>
                <button class="btn btn-danger">Admin Tools</button>
            </div>
        </div>

        <div id="gameBoard" class="game-board">
            <div class="game-header">
                <h2 id="gameTitle">Your Epic Challenge</h2>
                <p id="gameSubtitle">Complete all items to achieve victory!</p>
            </div>

            <div class="progress-section">
                <div class="progress-stats">
                    <div class="stat">
                        <div class="stat-value" id="currentScore">0</div>
                        <div class="stat-label">Score</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="totalItems">0</div>
                        <div class="stat-label">Total Items</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="completionPercent">0%</div>
                        <div class="stat-label">Complete</div>
                    </div>
                </div>
                <div class="progress-message" id="progressMessage">üí™ Let's get started!</div>
            </div>

            <div id="checklistContainer" class="checklist-grid">
                <!-- Checklist items will be generated here -->
            </div>

            <button class="btn" onclick="backToMenu()">Back to Menu</button>
        </div>

        <div id="leaderboard" class="leaderboard" style="display: none;">
            <h2>üèÜ Player Leaderboard</h2>
            <table class="leaderboard-table">
                <thead>
                    <tr>
                        <th>üèÜ Rank</th>
                        <th>üë§ Player</th>
                        <th>‚ö° Score</th>
                        <th>üéØ Difficulty</th>
                        <th>üé® Theme</th>
                        <th>üìà Progress</th>
                        <th>üìÖ Created</th>
                    </tr>
                </thead>
                <tbody id="leaderboardBody">
                    <!-- Leaderboard data will be populated here -->
                </tbody>
            </table>
            <button class="btn" onclick="hideLeaderboard()" style="margin-top: 20px;">Back to Menu</button>
        </div>
    </div>

    <!-- Create Game Modal -->
    <div id="createGameModal" class="modal">
        <div class="modal-content">
            <h2>üéØ Create New Game</h2>
            <form id="createGameForm">
                <div class="form-group">
                    <label for="playerName">üë§ Player Name:</label>
                    <input type="text" id="playerName" required placeholder="Enter your name">
                </div>

                <div class="form-group">
                    <label for="deviceType">üì± Device Type:</label>
                    <select id="deviceType">
                        <option value="desktop">üíª Desktop (Compact Layout)</option>
                        <option value="mobile">üì± Mobile (Touch-Friendly)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="difficulty">üéØ Difficulty Level:</label>
                    <select id="difficulty">
                        <option value="easy">üü¢ Easy (3√ó3 = 9 items)</option>
                        <option value="normal">üü° Normal (4√ó5 = 20 items)</option>
                        <option value="hard">üü† Hard (5√ó6 = 30 items)</option>
                        <option value="epic">üî¥ Epic (6√ó6 = 36 items)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="theme">üé® Theme:</label>
                    <select id="theme">
                        <option value="classic">üíô Classic (Blue)</option>
                        <option value="fire">üî• Fire (Red/Orange)</option>
                        <option value="nature">üåø Nature (Green)</option>
                        <option value="royal">üëë Royal (Purple)</option>
                        <option value="neon">‚ö° Neon (Pink/Cyan)</option>
                    </select>
                </div>

                <button type="submit" class="btn btn-success">üöÄ Create Game</button>
                <button type="button" class="btn" onclick="closeModal('createGameModal')">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Join Game Modal -->
    <div id="joinGameModal" class="modal">
        <div class="modal-content">
            <h2>üöÄ Join Existing Game</h2>
            <div id="existingGames">
                <!-- Will be populated with existing games -->
            </div>
            <button type="button" class="btn" onclick="closeModal('joinGameModal')">Cancel</button>
        </div>
    </div>

    <script>
        // Sample checklist items
        const checklistItems = [
            "Try a new restaurant", "Read a book you've been meaning to read", "Call an old friend",
            "Take a nature walk", "Learn something new online", "Organize your workspace",
            "Cook a meal from scratch", "Write in a journal", "Do a random act of kindness",
            "Watch a documentary", "Start a new hobby", "Exercise for 30 minutes",
            "Clean out your email inbox", "Plan your next vacation", "Take photos of something beautiful",
            "Listen to a new music genre", "Meditate for 10 minutes", "Write a thank you note",
            "Try a new recipe", "Go stargazing", "Visit a museum or gallery", "Learn 5 words in a new language",
            "Volunteer for a cause you care about", "Create something with your hands", "Have a picnic",
            "Watch the sunrise or sunset", "Call your family", "Donate items you don't need",
            "Try a new form of exercise", "Plant something", "Write down 3 things you're grateful for",
            "Explore a new neighborhood", "Have a device-free hour", "Make a playlist for a friend",
            "Try meditation or deep breathing", "Organize your photos", "Learn a magic trick",
            "Write a poem or short story", "Try a new coffee or tea", "Give someone a genuine compliment",
            "Learn to tie a new knot", "Watch a classic movie", "Take a cold shower",
            "Practice a musical instrument", "Draw or sketch something", "Try a new board game",
            "Have a conversation with a stranger", "Learn about a historical event", "Try rock climbing or bouldering",
            "Make homemade bread", "Go for a bike ride", "Try stand-up comedy (watch or try)",
            "Learn basic first aid", "Try a new dance style", "Go camping or sleep under stars",
            "Learn to juggle", "Try a new sport", "Make art with recycled materials",
            "Learn about different cultures", "Try geocaching", "Learn photography basics",
            "Try a new hairstyle", "Learn to solve a Rubik's cube", "Try bird watching",
            "Learn calligraphy or hand lettering", "Try a new form of transportation",
            "Learn about astronomy", "Try a new podcast", "Make a time capsule",
            "Learn basic coding", "Try urban sketching", "Learn about wine or coffee tasting",
            "Try a new makeup look", "Learn to whistle loudly", "Try a new video game genre",
            "Learn about different plants", "Try a new way to relax", "Learn a card trick",
            "Try a new art medium", "Learn about different architectural styles",
            "Try a new social media platform", "Learn about different types of clouds",
            "Try a new way to organize", "Learn about different types of music",
            "Try a new sleeping schedule", "Learn about different cultures' food",
            "Try a new way to exercise creativity", "Learn about different types of tea",
            "Try a new mindfulness technique", "Learn about different types of trees",
            "Try a new social activity", "Learn about different types of birds",
            "Try a new creative writing exercise", "Learn about different types of rocks",
            "Try a new way to connect with nature", "Learn about different types of flowers",
            "Try a new form of self-care", "Learn about different types of butterflies",
            "Try a new way to learn", "Learn about different constellations",
            "Try a new adventure activity", "Learn about different weather patterns",
            "Try a new creative project", "Learn about different ocean creatures",
            "Try a new way to help others", "Learn about different mountain ranges",
            "Try a new cultural experience", "Learn about different ecosystems",
            "Try a new skill", "Learn about different renewable energy sources",
            "Try a new form of entertainment", "Learn about different space phenomena",
            "Try a new way to express yourself", "Learn about different archaeological discoveries",
            "Try a new challenge", "Learn about different scientific breakthroughs"
        ];

        let currentGame = null;
        let gameData = JSON.parse(localStorage.getItem('epicChecklistGames')) || {};

        const difficultySettings = {
            easy: { name: 'Easy', rows: 3, cols: 3, total: 9, emoji: 'üü¢' },
            normal: { name: 'Normal', rows: 4, cols: 5, total: 20, emoji: 'üü°' },
            hard: { name: 'Hard', rows: 5, cols: 6, total: 30, emoji: 'üü†' },
            epic: { name: 'Epic', rows: 6, cols: 6, total: 36, emoji: 'üî¥' }
        };

        const themeSettings = {
            classic: { name: 'Classic', primary: '#4285F4', secondary: '#E8F0FE', accent: '#1A73E8', emoji: 'üíô' },
            fire: { name: 'Fire', primary: '#FF5722', secondary: '#FFF3E0', accent: '#D84315', emoji: 'üî•' },
            nature: { name: 'Nature', primary: '#4CAF50', secondary: '#F1F8E9', accent: '#2E7D32', emoji: 'üåø' },
            royal: { name: 'Royal', primary: '#9C27B0', secondary: '#F3E5F5', accent: '#7B1FA2', emoji: 'üëë' },
            neon: { name: 'Neon', primary: '#E91E63', secondary: '#FCE4EC', accent: '#C2185B', emoji: '‚ö°' }
        };

        function showCreateGameModal() {
            document.getElementById('createGameModal').style.display = 'block';
        }

        function showJoinGameModal() {
            const modal = document.getElementById('joinGameModal');
            const gamesContainer = document.getElementById('existingGames');
            
            gamesContainer.innerHTML = '';
            
            const games = Object.keys(gameData);
            if (games.length === 0) {
                gamesContainer.innerHTML = '<p>No existing games found. Create a new game first!</p>';
            } else {
                gamesContainer.innerHTML = '<h3>Available Games:</h3>';
                games.forEach(gameId => {
                    const game = gameData[gameId];
                    const gameDiv = document.createElement('div');
                    gameDiv.className = 'menu-card';
                    gameDiv.style.marginBottom = '15px';
                    gameDiv.innerHTML = `
                        <h4>${game.playerName}'s ${game.theme.name} ${game.difficulty.name} Game</h4>
                        <p>Progress: ${game.completedCount || 0}/${game.difficulty.total} (${Math.round(((game.completedCount || 0) / game.difficulty.total) * 100)}%)</p>
                        <p>Created: ${new Date(game.created).toLocaleDateString()}</p>
                        <button class="btn" onclick="joinGame('${gameId}')">Join This Game</button>
                    `;
                    gamesContainer.appendChild(gameDiv);
                });
            }
            
            modal.style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function createGame(playerName, difficulty, theme, deviceType) {
            const gameId = Date.now().toString();
            const difficultyData = difficultySettings[difficulty];
            const themeData = themeSettings[theme];
            
            // Shuffle and select items
            const shuffledItems = shuffleArray([...checklistItems]);
            const selectedItems = shuffledItems.slice(0, difficultyData.total);
            
            const game = {
                id: gameId,
                playerName: playerName,
                difficulty: difficultyData,
                theme: themeData,
                deviceType: deviceType,
                items: selectedItems,
                completed: new Array(difficultyData.total).fill(false),
                completedCount: 0,
                created: new Date().toISOString()
            };
            
            gameData[gameId] = game;
            localStorage.setItem('epicChecklistGames', JSON.stringify(gameData));
            
            return game;
        }

        function joinGame(gameId) {
            currentGame = gameData[gameId];
            closeModal('joinGameModal');
            showGameBoard();
        }

        function showGameBoard() {
            if (!currentGame) return;
            
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('leaderboard').style.display = 'none';
            document.getElementById('gameBoard').style.display = 'block';
            
            // Apply theme
            document.body.className = `theme-${Object.keys(themeSettings).find(key => themeSettings[key].name === currentGame.theme.name)}`;
            
            // Set game header
            document.getElementById('gameTitle').textContent = 
                `üéÆ ${currentGame.playerName}'s ${currentGame.theme.name} ${currentGame.difficulty.name} Challenge`;
            document.getElementById('gameSubtitle').textContent = 
                `${currentGame.difficulty.emoji} ${currentGame.difficulty.total} Items to Complete ‚Ä¢ ${currentGame.theme.emoji} ${currentGame.theme.name} Theme`;
            
            // Update progress
            updateProgress();
            
            // Generate checklist
            generateChecklist();
        }

        function generateChecklist() {
            const container = document.getElementById('checklistContainer');
            container.innerHTML = '';
            container.className = `checklist-grid ${currentGame.deviceType}`;
            
            currentGame.items.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = `checklist-item ${currentGame.completed[index] ? 'completed' : ''}`;
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `item-${index}`;
                checkbox.checked = currentGame.completed[index];
                checkbox.addEventListener('change', () => toggleItem(index));
                
                const label = document.createElement('label');
                label.htmlFor = `item-${index}`;
                label.textContent = `${index + 1}. ${item}`;
                
                itemDiv.appendChild(checkbox);
                itemDiv.appendChild(label);
                container.appendChild(itemDiv);
            });
        }

        function toggleItem(index) {
            currentGame.completed[index] = !currentGame.completed[index];
            currentGame.completedCount = currentGame.completed.filter(Boolean).length;
            
            // Update storage
            gameData[currentGame.id] = currentGame;
            localStorage.setItem('epicChecklistGames', JSON.stringify(gameData));
            
            // Update UI
            updateProgress();
            
            // Update item appearance
            const itemDiv = document.querySelector(`#item-${index}`).parentElement;
            itemDiv.className = `checklist-item ${currentGame.completed[index] ? 'completed' : ''}`;
        }

        function updateProgress() {
            const completed = currentGame.completedCount;
            const total = currentGame.difficulty.total;
            const percentage = Math.round((completed / total) * 100);
            
            document.getElementById('currentScore').textContent = completed;
            document.getElementById('totalItems').textContent = total;
            document.getElementById('completionPercent').textContent = `${percentage}%`;
            
            // Update progress message
            let message;
            if (completed === total) {
                message = "üéâ EPIC COMPLETION! YOU'RE A LEGEND! üéâ";
            } else if (completed > total / 2) {
                message = "üî• You're on fire! Keep going!";
            } else {
                message = "üí™ Just getting started!";
            }
            document.getElementById('progressMessage').textContent = message;
        }

        function showLeaderboard() {
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('gameBoard').style.display = 'none';
            document.getElementById('leaderboard').style.display = 'block';
            
            const tbody = document.getElementById('leaderboardBody');
            tbody.innerHTML = '';
            
            // Sort games by completion percentage and score
            const sortedGames = Object.values(gameData).sort((a, b) => {
                const aPercent = (a.completedCount || 0) / a.difficulty.total;
                const bPercent = (b.completedCount || 0) / b.difficulty.total;
                if (aPercent !== bPercent) return bPercent - aPercent;
                return (b.completedCount || 0) - (a.completedCount || 0);
            });
            
            sortedGames.forEach((game, index) => {
                const row = document.createElement('tr');
                const percentage = Math.round(((game.completedCount || 0) / game.difficulty.total) * 100);
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${game.playerName}</td>
                    <td>${game.completedCount || 0}/${game.difficulty.total}</td>
                    <td>${game.difficulty.emoji} ${game.difficulty.name}</td>
                    <td>${game.theme.emoji} ${game.theme.name}</td>
                    <td>${percentage}%</td>
                    <td>${new Date(game.created).toLocaleDateString()}</td>
                `;
                
                if (index < 3) {
                    row.style.background = index === 0 ? '#FFD700' : index === 1 ? '#C0C0C0' : '#CD7F32';
                    row.style.color = 'white';
                }
                
                tbody.appendChild(row);
            });
        }

        function hideLeaderboard() {
            document.getElementById('leaderboard').style.display = 'none';
            document.getElementById('mainMenu').style.display = 'grid';
        }

        function backToMenu() {
            document.getElementById('gameBoard').style.display = 'none';
            document.getElementById('mainMenu').style.display = 'grid';
            currentGame = null;
        }

        function showAdminPanel() {
            const password = prompt("Enter admin password:");
            if (password !== "admin123") {
                alert("‚ùå Incorrect password!");
                return;
            }
            
            const action = confirm("üóëÔ∏è Reset all game data? This cannot be undone!\n\nOK = Reset All\nCancel = Go Back");
            if (action) {
                if (confirm("‚ö†Ô∏è FINAL WARNING: This will delete ALL player games and scores!")) {
                    gameData = {};
                    localStorage.removeItem('epicChecklistGames');
                    alert("‚úÖ All game data has been reset!");
                    location.reload();
                }
            }
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Handle form submission
        document.getElementById('createGameForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const playerName = document.getElementById('playerName').value.trim();
            const difficulty = document.getElementById('difficulty').value;
            const theme = document.getElementById('theme').value;
            const deviceType = document.getElementById('deviceType').value;
            
            if (!playerName) {
                alert("‚ö†Ô∏è Please enter a player name!");
                return;
            }
            
            // Check if player already exists
            const existingGame = Object.values(gameData).find(game => 
                game.playerName.toLowerCase() === playerName.toLowerCase()
            );
            
            if (existingGame) {
                const overwrite = confirm(
                    `‚ö†Ô∏è Player "${playerName}" already exists!\n\n` +
                    `üîÑ OK = Replace their game (old progress will be lost)\n` +
                    `‚ùå Cancel = Choose a different name`
                );
                
                if (!overwrite) {
                    return;
                }
                
                // Delete existing game
                delete gameData[existingGame.id];
            }
            
            // Create new game
            currentGame = createGame(playerName, difficulty, theme, deviceType);
            
            closeModal('createGameModal');
            showGameBoard();
            
            // Show success message
            const difficultyData = difficultySettings[difficulty];
            const themeData = themeSettings[theme];
            setTimeout(() => {
                alert(`üéâ ${themeData.emoji} Epic ${difficultyData.name} board created for ${playerName}! ${difficultyData.emoji}`);
            }, 500);
        });

        // Close modals when clicking outside
        window.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });

        // Auto-detect mobile device
        function detectMobile() {
            return window.innerWidth <= 768 || /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        // Set default device type on page load
        window.addEventListener('load', function() {
            if (detectMobile()) {
                document.getElementById('deviceType').value = 'mobile';
            }
        });

        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // ESC to close modals
            if (e.key === 'Escape') {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    if (modal.style.display === 'block') {
                        modal.style.display = 'none';
                    }
                });
            }
            
            // Space to toggle current item (if in game)
            if (e.key === ' ' && currentGame && e.target.tagName !== 'INPUT') {
                e.preventDefault();
                // Find first unchecked item and check it
                const firstUnchecked = currentGame.completed.findIndex(completed => !completed);
                if (firstUnchecked !== -1) {
                    document.getElementById(`item-${firstUnchecked}`).click();
                }
            }
        });

        // Add touch gestures for mobile
        let touchStartY = 0;
        let touchEndY = 0;

        document.addEventListener('touchstart', function(e) {
            touchStartY = e.changedTouches[0].screenY;
        });

        document.addEventListener('touchend', function(e) {
            touchEndY = e.changedTouches[0].screenY;
            handleSwipe();
        });

        function handleSwipe() {
            const swipeThreshold = 50;
            const diff = touchStartY - touchEndY;
            
            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0) {
                    // Swipe up - could add functionality here
                } else {
                    // Swipe down - could add functionality here
                }
            }
        }

        // Auto-save progress every 30 seconds
        setInterval(function() {
            if (currentGame) {
                localStorage.setItem('epicChecklistGames', JSON.stringify(gameData));
            }
        }, 30000);

        // Quick game function (like the original)
        function quickGame() {
            const playerName = prompt("üöÄ Quick Game - Enter your name:");
            if (!playerName) return;
            
            currentGame = createGame(playerName, 'normal', 'classic', detectMobile() ? 'mobile' : 'desktop');
            showGameBoard();
            alert("üöÄ Quick Normal difficulty Classic game started!");
        }

        // Export/Import functionality for backup
        function exportGames() {
            const dataStr = JSON.stringify(gameData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'epic-checklist-games-backup.json';
            link.click();
            URL.revokeObjectURL(url);
        }

        function importGames() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        const merge = confirm("Merge with existing games? (Cancel = Replace all games)");
                        
                        if (merge) {
                            gameData = {...gameData, ...importedData};
                        } else {
                            gameData = importedData;
                        }
                        
                        localStorage.setItem('epicChecklistGames', JSON.stringify(gameData));
                        alert("‚úÖ Games imported successfully!");
                        location.reload();
                    } catch (error) {
                        alert("‚ùå Error importing file: " + error.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // Add some fun easter eggs
        let konamiCode = [];
        const konamiSequence = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'KeyB', 'KeyA'];

        document.addEventListener('keydown', function(e) {
            konamiCode.push(e.code);
            if (konamiCode.length > konamiSequence.length) {
                konamiCode.shift();
            }
            
            if (konamiCode.join(',') === konamiSequence.join(',')) {
                // Easter egg activated!
                document.body.style.animation = 'rainbow 2s infinite';
                setTimeout(() => {
                    document.body.style.animation = '';
                    alert("üéÆ Konami Code activated! You're a true gamer! üéÆ");
                }, 2000);
                konamiCode = [];
            }
        });

        // Add rainbow animation for easter egg
        const style = document.createElement('style');
        style.textContent = `
            @keyframes rainbow {
                0% { filter: hue-rotate(0deg); }
                100% { filter: hue-rotate(360deg); }
            }
        `;
        document.head.appendChild(style);

        // Add completion celebration
        function celebrateCompletion() {
            // Create confetti effect
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
            const confettiCount = 50;
            
            for (let i = 0; i < confettiCount; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.style.position = 'fixed';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.top = '-10px';
                    confetti.style.width = '10px';
                    confetti.style.height = '10px';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.pointerEvents = 'none';
                    confetti.style.zIndex = '9999';
                    confetti.style.animation = 'fall 3s linear forwards';
                    
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => {
                        confetti.remove();
                    }, 3000);
                }, i * 100);
            }
        }

        // Add falling animation for confetti
        const confettiStyle = document.createElement('style');
        confettiStyle.textContent = `
            @keyframes fall {
                from {
                    transform: translateY(-100vh) rotate(0deg);
                }
                to {
                    transform: translateY(100vh) rotate(360deg);
                }
            }
        `;
        document.head.appendChild(confettiStyle);

        // Enhanced toggle function with celebration
        const originalToggleItem = toggleItem;
        toggleItem = function(index) {
            const wasCompleted = currentGame.completed[index];
            originalToggleItem(index);
            
            // Check if game was just completed
            if (!wasCompleted && currentGame.completedCount === currentGame.difficulty.total) {
                setTimeout(() => {
                    celebrateCompletion();
                    alert("üéâ CONGRATULATIONS! You've completed your Epic Checklist! üéâ");
                }, 500);
            }
        };

        // Add stats tracking
        function getPlayerStats() {
            const games = Object.values(gameData);
            const totalGames = games.length;
            const completedGames = games.filter(game => 
                game.completedCount === game.difficulty.total
            ).length;
            const totalItemsCompleted = games.reduce((sum, game) => 
                sum + (game.completedCount || 0), 0
            );
            
            return {
                totalGames,
                completedGames,
                totalItemsCompleted,
                completionRate: totalGames > 0 ? Math.round((completedGames / totalGames) * 100) : 0
            };
        }

        // Show stats in console for debugging/fun
        console.log("üéÆ Epic Checklist Game Stats:", getPlayerStats());

        // PWA-like functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                // We're not actually registering a service worker, but this is where you would
                console.log("üéÆ Epic Checklist Game loaded successfully!");
            });
        }
    </script>
</body>
</html>